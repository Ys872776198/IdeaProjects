-- 创建部门表（dept） dept：department 部分， loc：location 位置
create table DEPT(
	DEPTNO	INT(2) NOT NULL,
	DNAME 	VARCHAR(14),
	LOC 		VARCHAR(13)
);
ALTER TABLE DEPT 
	ADD CONSTRAINT PK_DEPT PRIMARY KEY (DEPTNO);

-- 创建员工表（emp）emp：employee 员工， mgr：manager 上级领导， hiredate：入职日期， firedate：解聘日期， common：补助， daptno：参照 表dapt(deptno)
CREATE TABLE EMP(
	EMPNO		INT(4),
	ENAME		VARCHAR(10),
	JOB			VARCHAR(9),
	MGR			INT(4),
	HIREDATE	DATE,
	SAL			DOUBLE(7,2),
	COMM		DOUBLE(7,2),
	DEPTNO	INT(2)
);
ALTER TABLE EMP 
	ADD CONSTRAINT PK_EMP PRIMARY KEY (EMPNO);
ALTER TABLE EMP 
	ADD CONSTRAINT FK_EMP FOREIGN KEY (DEPTNO) 
	REFERENCES DEPT(DEPTNO) ON UPDATE CASCADE ON DELETE CASCADE;
-- ALTER TABLE EMP DROP FOREIGN KEY FK_EMP;

-- 创建薪资等级表表（salgrade）
CREATE TABLE SALGRADE(
	GRADE		INT,
	LOSAL		DOUBLE(7,2),
	HISAL		DOUBLE(7,2)
);
ALTER TABLE SALGRADE
	ADD CONSTRAINT PRIMARY KEY (GRADE);

-- 创建奖金表（bonus）
CREATE TABLE BONUS(
	ENAME		VARCHAR(10),
	JOB			VARCHAR(9),
	SAL			DOUBLE(7,2),
	COMM 		DOUBLE(7,2)
);

INSERT INTO DEPT VALUES(10, "ACCOUNTING", "NEW YORC");
INSERT INTO DEPT VALUES(20, "RESEARCH", "DALLAS");
INSERT INTO DEPT VALUES(30, "SALES", "CHICAGO");
INSERT INTO DEPT VALUES(40, "OPERATIONS", "BOSTON");

INSERT INTO EMP VALUES(7369, "SMITH", "CLERK", 7902, "1980-12-17", 800, NULL, 20);
INSERT INTO EMP VALUES(7499, "ALLEN", "SALESMAN", 7698, "1981-02-20", 1600, 300, 30);
INSERT INTO EMP VALUES(7521, "WARD", "SALESMAN", 7698, "1981-02-22", 1250, 500, 30);
INSERT INTO EMP VALUES(7566, "JONES", "MANAGER", 7839, "1981-04-02", 2975, NULL, 30);
INSERT INTO EMP VALUES(7654, "MARTIN", "SALESMAN", 7698, "1981-09-28", 1250, 1400, 30);
INSERT INTO EMP VALUES(7698, "BLAKE", "MANAGER", 7839, "1981-05-01", 2850, NULL, 30);
INSERT INTO EMP VALUES(7782, "CLARK", "MANAGER", 7839, "1981-06-09", 2450, NULL, 10);
INSERT INTO EMP VALUES(7788, "SCOTT", "ANALYST", 7566, "1987-04-19", 3000, NULL, 20);
INSERT INTO EMP VALUES(7839, "KING", "PRESIDENT", NULL, "1981-11-17", 5000, NULL, 10);
INSERT INTO EMP VALUES(7844, "TURNER", "SALESMAN", 7698, "1981-09-08", 1500, 0, 30);
INSERT INTO EMP VALUES(7876, "ADAMS", "CLERK", 7788, "1987-05-23", 1100, NULL, 20);
INSERT INTO EMP VALUES(7900, "JAMES", "CLERK", 7698, "1981-12-03", 950, NULL, 30);
INSERT INTO EMP VALUES(7902, "FORD", "ANALYST", 7566, "1981-12-03", 3000, NULL, 20);
INSERT INTO EMP VALUES(7934, "MILLER", "CLERK", 7782, "1982-01-23", 1300, NULL, 10);

INSERT INTO SALGRADE VALUES(1, 700, 1200);
INSERT INTO SALGRADE VALUES(2, 1201, 1400);
INSERT INTO SALGRADE VALUES(3, 1401, 2000);
INSERT INTO SALGRADE VALUES(4, 2001, 3000);
INSERT INTO SALGRADE VALUES(5, 3001, 9999);

-- 除了多行函数（max, min, count, sum, avg）就是单行函数
-- 分组GROUP BY
-- 统计各个岗位的平均工资
SELECT DEPTNO, AVG(SAL) FROM EMP;			-- 字段是不能和多行函数同时使用的，除非这个字段属于分组
SELECT DEPTNO, AVG(SAL) FROM EMP GROUP BY DEPTNO ORDER BY SAL ASC;

-- 统计各个岗位的平均工资，且显示平均工资大于2000的岗位(HAVING 是在分组之后的二次筛选)
SELECT DEPTNO, AVG(SAL) AS "平均工资" FROM EMP GROUP BY DEPTNO HAVING AVG(SAL) > 1800 ORDER BY "平均工资" ASC;
-- SELECT DEPTNO, AVG(SAL) AS "平均工资" FROM EMP GROUP BY DEPTNO HAVING "平均工资" > 1800 ORDER BY "平均工资" ASC;		-- 用别名代替AVG(SAL)

-- 统计各个岗位的平均工资,除了MILLER
-- 	方法1、利用wehere 分组前进行过滤
SELECT JOB, AVG(SAL) AS "平均工资" FROM EMP WHERE JOB != "MILLER" GROUP BY JOB ORDER BY ASC;
-- 	方法1、利用HAVING 分组后进行过滤
SELECT JOB, AVG(SAL) AS "平均工资" FROM EMP GROUP BY JOB HAVING JOB != "MILLER" ORDER BY AVG(SAL) DESC;


/*
select总结：
	select结构顺序
	select ———— from ———— where ———— group by ———— having ———— order by
	注意：顺序固定，不可以改变顺序

	select执行顺序
	from ———— where ———— group by ———— select ————  having ———— order by



*/

-- SELECT JOB FROM EMP GROUP BY JOB HAVING AVG(SAL) < 2000  ORDER BY JOB ASC;
-- 
-- SELECT DEPTNO, JOB FROM EMP GROUP BY DEPTNO, JOB HAVING AVG(SAL) > 1200 ORDER BY DEPTNO ASC;



-- 查看数据库对象的结构
desc DEPT;
desc EMP;
desc SALGRADE;
desc BONUS;

-- 查看t_student的内容
select * from DEPT;
select * from EMP;
select * from SALGRADE;
select * from BONUS;

-- 删除数据
delete from DEPT;
delete from EMP;
delete from SALGRADE;
delete from BONUS;

-- 查看数据库的创建语句
show CREATE table DEPT;
show CREATE table EMP;
show CREATE table SALGRADE;
show CREATE table BONUS;

-- 删除数据库
Drop table DEPT;
Drop table EMP;
Drop table SALGRADE;
Drop table BONUS;